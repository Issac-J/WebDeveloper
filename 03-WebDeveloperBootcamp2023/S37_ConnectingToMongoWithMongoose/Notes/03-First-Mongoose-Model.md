###### script

지난 영상에선 Mongoose를 이용해 JavaScript 파일을

MongoDB에 연결하는 방법을 배웠습니다

이제 Mongoose로 뭘 할지 배워야겠죠

Mongoose를 이용하는 핵심 목표는

JavaScript에서 MongoDB와 더 쉽게

상호 작용하기 위함이란 걸 기억하세요

Mongoose에 대해 중점적으로 다룰 내용은

바로 모델을 이해하는 것입니다

모델은 Mongoose의 도움으로 생성되는

JavaScript 클래스로 MongoDB의 정보를 나타내며

구체적으로는 어떤 집합의 정보를 나타내는 것입니다

영화로 작업을 해 볼 건데요

Mongoose의 도움을 받아 영화 모델을 만들 수 있습니다

Mongoose는 데이터베이스에서 작성한 영화 정보와

상호 작용할 수 있는 다양한 메서드를 제공합니다

참고서 페이지에서 API 아래에 있는 Model 메뉴를 보면

정말 다양한 기능의 Model 메서드를 확인할 수 있죠

우리가 만드는 JavaScript 클래스는

MongoDB에서 가져온 데이터로 모델을 만들고

상호 작용을 도와 데이터베이스나 쿼리로 새로운 정보를 보내고

삭제하거나 업데이트하는 것을 도와줍니다

각기 다른 리소스와 집합을 MongoDB와 작업할 건데

JavaScript 파일에서 데이터를 사용하거나 접근하려면

각 데이터를 정의하는 모델을 만들어야 해요

이 중 첫 번째로 정의할 모델은 스키마(Schema)입니다

여긴 Getting Started라고 써 있지만 Quick Start예요, 여기로 가서

이 코드를 보세요

new mongoose.Schema의 Schema가 뭘까요?

용어가 갖는 '도식'이라는 의미를 봐서 청사진이 떠오르죠

스키마는 Mongo의 각기 다른 키 집합을

JavaScript의 다른 타입으로 구조를 짜는 것을 말합니다

JavaScript나 기타 언어에서 다른 타입인 데이터를

Mongo로부터 가져오지만

그 언어에 데이터 타입이 있을 수도 있고 없을 수도 있죠

스키마를 정의함으로써 구체화합니다 예를 들어 title은 문자열이고

JavaScript에서 body는 문자열 hidden은 불리언이어야 하죠

이 경우에는 블로그가 어떻게 보여야 하는지 정의하듯

영화도 어떻게 보일지 정의를 해야겠죠

영화 앱을 위해 영화 정보를 구성한다고 생각합시다

영화마다 필요한 정보는

제목으로 문자열인 Amadeus가 들어갈 거고

개봉 연도도 있죠?

언제 개봉한지는 몰라도 훌륭한 영화예요

수도 없이 얘기한 거 같아요 개봉 연도는 1986년으로 하죠

지어낸 건데 1986년으로 할게요

또 뭐가 있을까요?

제목, 개봉 연도가 있으니 등급이 있어야겠죠?

10점 만점에 9.2점을 줄게요 review로 고치겠습니다

그냥 score라고 하죠

이제 등급인 rating을 추가하고 문자열인 R을 넣을게요

여기엔 PG13이나 PG, MPAA 같은 게 들어갈 수도 있겠죠

이건 스키마가 아니에요

그냥 영화 정보를 어떻게 표시할지 예시로 만든 거예요

스키마를 정의하려면 이 타입이 뭔지 생각해야 합니다

제목은 문자열이고 개봉 연도는 숫자죠

평점도 숫자, 등급은 문자열로 이제 스키마를 정의하겠습니다

movieSchema를 선언해 new mongoose.Schema를 추가하고

객체에 키-값 쌍을 전달하겠습니다

예를 들어 제목인 title은 문자열로 설정되어야 하고

여기 정의한 키는 Mongo 문서에서

키를 설정할 때도 사용됩니다

그러니 어떻게 이름을 지을지 생각해야겠죠?

나중을 생각해서 구체적으로 지어야 할 수도 있으니까요

개봉 연도인 year는 숫자로 평점인 score도 숫자로

등급인 rating은 문자열로 설정할게요

이제 각기 다른 타입이 있습니다

이 코드는 제거할게요 타입에 접근할 수 있죠

참고서를 보면 다양한 종류를 확인할 수 있습니다

문자열, 숫자, 날짜, 불리언이나 객체 ID, 배열, 버퍼 등이 있습니다

기초적인 것부터 배우도록 하겠습니다

문자열, 불리언, 숫자 같은 거요

스키마를 정의하는 걸로는 데이터베이스에 영향을 주지 않아요

JavaScript와 동일하게 다루기 위한 방법일 뿐이죠

이제 이 스키마를 가져와서 Mongoose를 통해

이 스키마를 이용한 모델을 만들도록 하겠습니다

mongoose.model을 이용하면 됩니다

mongoose.model()을 쓸게요

이 부분에서 많이들 실수해요

모델 이름을 나타내는 문자열을 입력한 후

그다음에 스키마를 입력해야 합니다

여기 작성한 모델 이름은 매우 중요하므로

단수형이면서 첫 번째 문자는 대문자로 작성해야 합니다

그럼 Mongoose는 그 이름을 딴

Movies라는 집합을 생성할 거예요

자동으로 복수형이 되고 첫 문자도 소문자로 바뀝니다

집합 이름은 movies고 모델 이름은 Movie인 거죠

단순히 레이블이 아니에요

Mongoose에서 집합을 만든 거니까요

이제 이 결과를 변수로 저장하겠습니다

클래스를 생성할 텐데 주로 모델 이름과 똑같이 입력해요

이제 movie라는 모델 클래스가 생겼죠

여전히 데이터베이스에는 영향을 주지 않아요

하지만 movie 클래스의 새로운 인스턴스를 만들 수 있으니

이제 MongoDB에 저장할 수 있겠죠

과정을 함께 살펴보도록 합시다

new Movie로 새로운 영화 정보를 생성한다고 칠게요

제목부터 입력하겠습니다

새 영화는 Amadeus고 개봉 연도는 1986년으로

평점은 9.2이고 등급은 R인 영화입니다

여기까지도 데이터베이스에는 여전히 영향을 주지 않습니다

Amadeus라는 변수로 저장한다고 하더라도

뭔가 생성하거나 추가되지 않습니다

하지만 movie라는 새로운 인스턴스를 생성하게 하는데

이제 이걸 Terminal에 가져와 보겠습니다

Node REPL을 이용해 파일을 실행한 다음

.load를 호출해 파일 이름인 index.js를 입력한 후

아래 공간을 좀 만들게요

이제 제가 생성한 Amadeus에 접근할 수 있습니다

이건 제가 만든 모델이며 제가 돌려받은 영화 인스턴스예요

제목, 개봉 연도, 평점 등급이 다 있죠

ID도 생성되었네요

하지만 Mongo Shell에서 살펴볼 게 있습니다

우선 지우고 use movieApp을 입력한 후 영화 집합을 찾을게요

db.movies.find를 입력했지만 아무것도 뜨지 않네요

아직 MongoDB에 집합이 생성되지 않았다는 뜻이죠

하지만 JavaScript에 이 객체가 있으니까

데이터베이스에 저장하고 싶으면 save를 호출하면 됩니다

생성한 객체에 사용되는 메서드로 모델을 생성하면 따라옵니다

save는 영화 정보로 작성한 걸 뭐든 가져가서

어떤 데이터이든 데이터베이스에 저장합니다

데이터를 가져가서 Mongo로 옮기는 거죠

실행해 보겠습니다

Promise를 반환하네요 지금 기다리고 있는 게 아닙니다

.then이나 .catch가 아니니까요

그래도 작동해야 하는 걸 알죠

이제 db.movies.find를 입력하면 데이터가 뜨죠

집합에 포함된 새로운 문서인 영화 정보가 떴습니다

ID, 제목, 개봉 연도, 평점 등급이 모두 있네요

JavaScript에서 보면 Amadeus라는 변수가 있었죠

내부 정보인 평점을 바꿀 경우에

amadeus.score를 입력하고 9.5점으로 수정해 보겠습니다

Mongo에는 영향을 주지 않고

JavaScript에서만 수정되었습니다

하지만 amadeus.save로 저장할 수 있죠

이제 다시 돌아가서 적용되었는지 확인해 보면

movies 집합에서 영화 평점이 9.5로 바뀌었어요

여기까지 할 게 참 많죠

더 배울 게 남았어요

하지만 유용한 점을 확인했을 거예요

JavaScript에서 새로운 영화 정보를 만들고

데이터를 전달하면 JavaScript 객체가 되고

메서드를 사용할 수 있죠

참고서에서 save를 포함한 다양한 메서드를 볼 수 있어요

배운 메서드가 그것뿐이네요

하지만 곧 더 배울 겁니다

ID로 찾는 메서드나 삭제나 교체하는 메서드 등을요

업데이트하는 다양한 메서드도 있어요

생성하거나 삭제하는 다양한 메서드들은

모두 모델에서 사용할 수 있습니다

영화를 예시로 모델을 만들어 봤어요

나중에는 여러 모델을 작업할 거예요

자동으로 집합을 만든다는 게 이 강의의 핵심 주제인 것 같네요

우리가 활용할 수 있는 JavaScript 객체가 있었죠

그걸 바꾸거나 수정해서 Mongo에 반영되게 했습니다

배울 게 많이 남았는데 '여전히'라는 표현은 삼가겠지만

이 내용이 계속 어렵더라도 걱정하지 마세요

더 많이 연습해 볼 거고 아직은 까마득하게 느껴지겠지만

배우면 배울수록 모델의 유용함을 느끼게 될 거예요

그냥 하는 게 제일 쉬워요

하라는 대로 그냥 하면서 배우는 거죠

결국엔 다 도움이 될 거예요
