###### script

그럼 Mongoose 설치부터 시작하겠습니다

그냥 NPM 패키지로 실제 Mongo 데이터베이스에

연결하기만 하면 됩니다

Mongoose 참고서는 Mongoosejs.com에 있습니다

Mongoose으로 작업할 때면 항상 열어두는 편입니다

솔직히 제가 구문을 잘 기억하질 못하거든요

정말 솔직히 말하는 거예요 저는 항상 참고서 보고 합니다

'Mongoose를 올바르게 연결하는 방법이 뭐였지?'하면서요

그냥 좀 어려워요

아마 프로젝트당 한 번만 하면 되기 때문인 것 같아요

여기 있는 라인 혹은 코드는

연결을 위해 한 번만 사용하게 됩니다 여러분에게 보여드릴 나머지 코드는

좀 더 자주 다루게 될 내용이고요

그렇다 하더라도 참고서를 참고해야겠지만요

일단 Mongoose 설치부터 시작할 겁니다

Mongoose는 NPM 패키지입니다

빈 폴더를 열었어요

이 영상이나 향후 몇 개의 영상에서는

Express 앱을 사용하지 않을 겁니다

Mongoose 단독 사용을 위해 일반 JavaScript 파일을 쓸 거고

Express도, 웹 관련 내용도 없을 거고 바로 Express 앱으로 넘어갈 겁니다

여기 NPM 저장소를 초기화하여

새 프로젝트를 만든 뒤 Mongoose를 설치할 겁니다

됐고, index.js도 만들 겁니다 됐네요

이번에는 제 에디터 VSCode로 이동합니다

Mongoose를 불러와야 하니

const mongoose = require ('mongoose')

또 우리의 실행 목표는 Mongoose를 백그라운드에서 실행중인

Mongo DB 서버에 연결하는 겁니다

Mongo Daemon을 떠올려보세요

이 코드는 Mongoose 참고서에서 확인하실 수 있습니다

mongoose.connect를 쓰는데 사실 참고서가 아니라 홈페이지네요

read the docs를 클릭하면 connect 참고서가 나오고요

Mongo 데이터베이스가 위치한 URI를 추정해 줍니다

그리고 선택적으로 객체에 입력할 수 있는 여러 옵션들도

보이는군요

개발 중에 제가 처음으로 떠올릴 수 있는 것은

기본 Mongo Port인데 27017입니다

Mongo 참고서에서도 확인하실 수 있습니다

Mongo Daemon의 기본 포트는 이거라고요

전 외우지 못하지만요

여기 온 이유에는 이걸 복사하려는 것도 포함되어 있었고요

연결을 위해 그냥 이 라인을 여기로 복사하고 URI에 집중하죠

여기서 특정하고 있는 것은 Mongo DB가 어디서 찾는지

내 기기의 어디에 있는지 만이 아닙니다 어떤 데이터베이스를 쓸지도 특정하죠

당장은 test 데이터베이스를 쓰는데 없더라도 상관 없습니다

하나 새로 만들어줄 거고 있다면 그걸 쓸 테니까요

지금까지 우리는 cats, dogs 같은 걸로 작업했었는데

이번에는 영화 어떨까요?

영화를 위한 집합을 만들고 각각의 영화에는

제목, 평점, 리뷰 같은 내용들이 들어가겠죠

그러니 저라면 아마 movieApp이나 moviesDB라고 부를 것 같네요

됐고요 저건 아직 존재하지 않는 겁니다

Mongo Shell에서 만들지 않았어요

Shell에선 못 찾을 겁니다

다음으로는 Mongoose가 권장하는 옵션들이 있습니다

홈페이지의 참고서를 보시면 useNewUrlParser가 있는데

문서의 어디에 있는지 모르겠네요

너 어딨니?

Use... 이게 왜 안 보이지?

여기 있네요 기본값은 false입니다

우린 true로 설정해 새 Mongo DB URL 파서 논리에 들어갈 겁니다

이렇게 하는 편이 Mongoose에 적합하다면 해야죠

다음 두 번째 옵션은 useUnifiedTopology인데

당장은 깊이 볼 필요가 없고요

기본값은 false입니다

하지만 참고서에서는 true를 추천하는군요

제 생각엔 요즘 이걸 꺼두면 이 항의 경고가 뜰 것 같은데요

Mongoose는 기본적으로 이걸 포함시켜야 한다고 경고합니다

만약 Terminal에서 파일을 실행시키면... DeprecationWarning 어쩌고...

상관 없습니다만 MongoClient constructor에

useUnifiedTopology: true 옵션을 입력하라네요

그 말대로 해주죠

좋습니다 여기 넣도록 하죠

만약 이 코드를 실행할 경우 이미 알아차리셨을지 모르겠네요

커서가 멍 때리는... 이건 좀 어감이 좋질 않네요

그냥 커서가 변했다고 합시다

서버가 시작되었거나 뭔가가 진행중인 모양입니다

아직 작동이 끝나지 않았어요

이건 아마도 현시점에서 이 DB에 연결되었기 때문일 겁니다

확신할 수는 없지만요

하지만 확신할 수 있는 방법이 있죠 사실 몇 가지 있는데

Ctrl + C로 멈춰줍니다

참고서로 가보시면

제가 Mongoose 참고서를 좀 싫어하는 이유가 이건데요

read the docs로 들어가서 Quick Start로 가세요

여기 연결 부분 다음을 보시면

여기 있는 이 라인을 입력할 것을 권장하고 있습니다

아이고, 그냥 이걸 복사하죠

외우고 있을 것도 아니니까 직접 입력하실 필요 없습니다

첫 번째로 알아차리셨을 점은 콜백이 개입했다는 겁니다

원래 나쁜 건 아닌데요

다행히도 Mongoose는 Promises도 지원합니다

그러니 우리는 이렇게 해보죠

입문 가이드에서는 이 접근법을 제시해주었지만 말이죠

이게 여기서 하는 일은 오류가 있을 경우 콘솔에 프린트해주는 겁니다

일단 연결이 성공적으로 열렸다면 여기 console.log()를 입력하여

"CONNECTION OPEN!!!"을 입력하죠

이걸 실행해보면 좋습니다, 바로 연결이 열렸네요

거의 즉시 말이죠 JavaScript 시간에선 느린 거죠

뭔가에 연결하려고 할 때는 항상 시간이 걸리죠

하지만 예를 들어 여기 이 포트를 바꿔보면

이 연결이 실패할 때까지 시간이 걸리는 것을 알 수 있습니다

오류가 뜰 테니까요

좀 돼라, 좀 돼라...

이따가 다시 봅시다

기다리는 동안 더 나은 옵션을 보여드리죠

참고서에서 Getting Started가 아니라

여기 있는 Connections로 가보시면

.catch()를 사용하면 모든 연결 오류들을

해결할 수 있다고 합니다 이 connect 메서드가

Promise를 반환하기 때문이죠 그러니 .catch를 더해줄 수 있습니다

여길 보시면 여기 발생한 오류고요

드디어 뭔가가... 뭐라고 불러야 하지? MongooseConnectionRefused?

맞네요, 연결이 거부되었습니다

작동하지 않은 거죠

보기 좋은 오류는 아니지만 이걸 다 지워버리겠습니다

요즘 쓰는 더 나은 방법을 사용해보죠

여기 2도 다시 추가해서 올바른 포트로 만들어주고 ;도 지워준 뒤

.then을 추가해서 이 안에 console.log

("CONNECTION OPEN!!!")을 입력하고 .catch를 추가하면

만약 오류가 있을 경우에는 이렇게 뜨게 합시다

console.log에

("OH NO ERROR!!!!")를 입력하죠

그리고 console.log로 오류 자체를 보이게 합시다

그럼 다시 해보죠 싹 지우고요

CONNECTION OPEN!!!

좋은 소식이네요 먹혔습니다

만약 작동 중인 Mongo Daemon이 없거나

혹은 빠르게 실패하게 만들 수 있는 방법은

잘못된 포트를 사용하는 겁니다

그냥 한 숫자만 바꾸는게 아니라요 이러면 그 포트로 연결을 시도합니다

사용할 수 있는 포트니까요

하지만 이런 식으로 바꿔버린다면

포트 6이 몇 개였는지 기억이 안 나네요 전혀 모르겠어요

하지만 포트에는 최대 숫자가 있습니다 그리고 됐네요

OH NO ERROR!!!!가 보이죠

.catch 콜백이 작동했고 ParseError: Invalid Port (larger than 65535)

그러니까 이건 사용할 수 없는 포트입니다

연결하려고 시도조차 하지 않았어요

그냥 문제가 있다고 인지했죠

현재 단일 파일에 로직을 설정하여

Mongoose를 불러내 Mongo의 DB와 서버에 연결하려 했습니다

그리고 문제가 발생했다면 해결해주세요

사실 해결할 방법은 거의 없죠 뭔가가 출력되게 해서 오류를 잡을 뿐이죠

만약 성공했다면, console.log ("CONNECTION OPEN")이 뜨겠죠

다음 몇 개의 영상에서는 연결되었을 경우 뭘 할 수 있는지에 대해 더 배우겠습니다
